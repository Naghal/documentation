---
العنوان: "GraphQL"
MetaTitle: "GraphQL"
MetaDescription: "المكون الإضافي GraphQL ل OpenReplay."
---

استيراد Aside من '~/components/Aside.astro'

يتيح لك هذا المكون الإضافي تلقي طلبات GraphQL وفحصها لاحقًا أثناء إعادة تشغيل تسجيلات الجلسات. هذا مفيد جدًا لفهم وإصلاح المشاكل. يتوافق مكون الإضافي GraphQL مع تنفيذات Apollo و Relay.

<Aside type="tip">
  لدينا أيضًا دليلًا مفصلًا حول كيفية استخدام مكون الإضافي GraphQL لالتقاط وتعديل الطلبات، يمكنك التحقق منه [هنا](/tutorials/graphql).
</Aside>

## التثبيت


```bash
npm i @openreplay/tracker-graphql
```


## الاستخدام

سيقوم الاستدعاء للمكون الإضافي بإرجاع الدالة التي تتلقى أربعة متغيرات: "operationKind"، "operationName"، "variables" و "result". يقوم بإرجاع "result" دون أي تغيير.

### إذا كان موقعك تطبيقًا واحدًا للصفحات (SPA)


```js
import OpenReplay from '@openreplay/tracker';
import trackerGraphQL from '@openreplay/tracker-graphql';
//...
const tracker = new OpenReplay({
  projectKey: PROJECT_KEY,
});

export const recordGraphQL = tracker.use(trackerGraphQL());

tracker.start();
```


### إذا كان موقعك يتم تحميله على الخادم (SSR)

تابع المثال التالي إذا كان التطبيق SSR. تأكد من أن "tracker.start()" يتم استدعاؤه مرة واحدة عند بدء التطبيق على الجانب الخاص بالعميل (في "useEffect" أو "componentDidMount").


```js
// openreplay.js
import OpenReplay from '@openreplay/tracker/cjs';
import trackerGraphQL from '@openreplay/tracker-graphql/cjs';

export const tracker = new OpenReplay({
  projectKey: PROJECT_KEY
});
export const recordGraphQL = tracker.use(trackerGraphQL());

// MyApp.js
import { tracker } from './openreplay';

function MyApp() {
  useEffect(() => { // use componentDidMount in case of React Class Component
    tracker.start();
  }, [])
}
//...
```


### Relay

ل [Relay](https://relay.dev/) يجب عليك وضع استدعاء "recordGraphQL" في "NetworkLayer" المنفذ. إذا كان لديك طريقة "Network.create" القياسية لتنفيذه، فيجب عليك اتباع المثال التالي.


```js
import { Environment } from 'relay-runtime';
import { recordGraphQL } from './openreplay'; // see above for recordGraphQL definition

//...
function fetchQuery(operation, variables, cacheConfig, uploadables) {
  return fetch('ENDPOINT', {
  //...
  })
    .then(response => response.json())
    .then(result =>
      recordGraphQL(operation.operationKind, operation.name, variables, result)
    );
}
//...
const network = Network.create(fetchQuery);
```


انظر [Relay Network Layer](https://relay.dev/docs/en/network-layer) للتفاصيل.

### Apollo

ل [Apollo](https://www.apollographql.com/) يجب عليك إنشاء سلسلة "ApolloLink" جديدة مع استدعاء "recordGraphQL" ووضعها في سلسلتك. هذا هو المثال الذي يوضح كيفية القيام بذلك.


```js
import { ApolloLink } from '@apollo/client';
import { recordGraphQL } from './openreplay'; // see above for recordGraphQL definition

const trackerApolloLink = new ApolloLink((operation, forward) => {
  return forward(operation).map(result) => {
    const operationDefinition = operation.query.definitions[0];
    return recordGraphQL(
      operationDefinition.kind === 'OperationDefinition' ? operationDefinition.operation : 'unknown?',
      operation.operationName,
      operation.variables,
      result
    );
  });
});
//...
const link = ApolloLink.from([
  trackerApolloLink,
  //...
]);
```

