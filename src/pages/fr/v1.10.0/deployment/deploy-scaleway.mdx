---
titre: "Déployer sur Scaleway"
metaTitle: "Déployer sur Scaleway"
metaDescription: "Guide étape par étape pour déployer OpenReplay sur Scaleway Elements."
layout: ~/layouts/MainLayout.astro
i18nReady: true
---

La pile OpenReplay peut être installée sur une seule instance et Scaleway Elements est un candidat idéal. Voici comment le faire.

## Lancez une instance

1. Allez dans le tableau de bord Scaleway
2. Accédez à « Compute> Instances » puis cliquez sur « Créer une instance »
3. Choisissez votre zone de disponibilité préférée
4. Sélectionnez une image. Pour ce guide, nous utiliserons *Ubuntu Server 20.04 Focal Fossa*
5. Choisissez votre type d'instance. Les spécifications minimales sont `2 vCPUs, 8 Go de RAM, 50 Go de stockage`, sinon les services de backend OpenReplay ne démarreront tout simplement pas. Nous vous recommandons donc **au moins** le `DEV1-L` (ou un équivalent), qui est suffisant pour un volume faible / modéré. Si vous attendez un trafic élevé, vous devez le mettre à l'échelle à partir d'ici.
6. Ajoutez des volumes: définissez la taille à au moins 50 Go (stockage local ou bloc)
7. Donnez à votre instance un joli nom (par exemple openreplay)
8. Clés SSH: assurez-vous d'avoir déjà une clé associée à votre projet afin que vous puissiez vous connecter à votre instance
9. Cliquez sur « Créer une nouvelle instance »

> **Note:** Les ports SMTP (25, 465, 587) sont bloqués par défaut par Scaleway. Votre instance OpenReplay ne pourra pas envoyer de courriels à moins que vous n'activiez SMTP à partir de votre configuration de groupe de sécurité. Pour ce faire, consultez ce [rapide tutoriel](https://www.scaleway.com/en/faq/why-can-i-not-send-any-email/).

## Déployez OpenReplay

1. Assurez-vous que votre instance est `Started` puis connectez-vous à elle:


```bash
## From your terminal
SSH_KEY=~/Downloads/openreplay-key.pem #! wherever you've saved the SSH key
INSTANCE_IP=REPLACE_WITH_INSTANCE_PUBLIC_IP
chmod 400 $SSH_KEY
ssh -i $SSH_KEY root@$INSTANCE_IP
```


2. Installez OpenReplay en fournissant le domaine sur lequel il sera exécuté (par exemple DOMAIN_NAME = openreplay.mycompany.com):


```bash
git clone https://github.com/openreplay/openreplay.git
cd openreplay/scripts/helmcharts
DOMAIN_NAME=openreplay.mycompany.com bash init.sh
```


## Configurer TLS / SSL

OpenReplay traite des données d'utilisateur sensibles et nécessite donc HTTPS pour fonctionner. C'est obligatoire, sinon le suivi ne commencerait tout simplement pas à enregistrer. La même chose s'applique au tableau de bord, sans HTTPS vous ne pourrez pas rejouer les sessions utilisateur.

Vous devez donc apporter (ou générer) votre propre certificat SSL.

1. Tout d'abord, allez dans « Réseau »> « DNS » (ou votre autre fournisseur de service DNS) et créez un `A Record`. Utilisez le domaine que vous avez fourni lors de l'étape d'installation et pointez-le vers l'instance en utilisant son adresse IP publique (disponible dans « Compute »> « Instances »).

2. Si vous apportez votre propre certificat, créez un secret SSL à l'aide de la commande suivante: `kubectl create secret tls openreplay-ssl -n app --key="private_key_file.pem" --cert="certificate.crt"`.

> **Note:** Si vous n'avez pas de certificat, générez-en un, qui se renouvelle automatiquement, pour votre sous-domaine (celui fourni lors de l'installation) à l'aide de Let's Encrypt. Connectez-vous simplement à l'instance OpenReplay, exécutez `cd openreplay/scripts/helmcharts && bash certmanager.sh` et suivez les étapes.

3. Si vous souhaitez activer la redirection http vers https (recommandé), décommentez alors le bloc ci-dessous, dans la section `ingress-nginx`, dans `/var/lib/openreplay/vars.yaml`:


```yaml
ingress-nginx: &ingress-nginx
  controller:
    config:
      ssl-redirect: true
      force-ssl-redirect: true
```


Il vaut la peine de mentionner que notre `ingress-nginx` s'exécute par défaut sur les ports `80|443`, mais cela peut être facilement modifié, si nécessaire, dans `vars.yaml`:


```yaml
ingress-nginx: &ingress-nginx
  controller:
    service:
      ports:
        http: 80
        https: 443
```


4. Enfin, réinstallez OpenReplay NGINX:


```bash
openreplay -R
```

