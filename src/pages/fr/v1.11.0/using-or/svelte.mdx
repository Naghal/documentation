---
titre: "Utiliser OpenReplay avec Svelte"
metaTitle: "Utiliser le suivi √† l'int√©rieur d'un projet Svelte"
metaDescription: "Apprenez √† suivre vos utilisateurs sur votre projet Svelte"
---
import GoDeeperFooter from '~/components/go-deeper-footer.astro'

L'installation du suivi OpenReplay dans un projet bas√© sur Svelte est relativement simple.

La cl√© pour le faire fonctionner sera l'utilisation du contexte, qui, bien qu'il ressemble √† ce que nous faisons avec Next.js, l'impl√©mentation sera diff√©rente.

## D√©p√¥t d'exemple

Si vous souhaitez consulter le code complet de ce projet, consultez [le d√©p√¥t que nous utiliserons tout au long de ce didacticiel](https://github.com/deleteman/openreplay-svelte-example).

C'est une application SvelteKit d'exemple que vous pouvez cloner et tester vous-m√™me en suivant les instructions du fichier Readme.

Une fois d√©ploy√© et configur√©, vous devriez √™tre en mesure de capturer des reprises de session comme indiqu√© dans la capture d'√©cran ci-dessous:

![Relecture de session Svelte](images/svelte-session.png)

## Utilisation du contexte pour partager des donn√©es

Cette solution utilisera le contexte de Svelte, qui vous permet de partager des donn√©es entre un composant parent et tous ses enfants (comme le fournisseur de contexte de React).

Dans cet exemple particulier, nous ajouterons le suivi pour la section Admin de notre application, nous d√©finirons donc le contexte dans le fichier de mise en page Admin (`src/layout/Admin.svelte`). Ensuite, nous le d√©marrerons √† la premi√®re page affich√©e √† l'int√©rieur de cette section.

## Cr√©ation du contexte de suivi

√Ä l'int√©rieur du fichier `src/layout/Admin.svelte`, dans la balise `script`, ajoutons le code suivant:


```jsx
import {Tracker, key} from "../context/tracker"

let tracker = new Tracker({
    projectKey: __myapp.env.OPENREPLAY_PROJECT_KEY
});
  
setContext(key, {
 getTracker: () => tracker
} )
```
 Bien s√ªr, vous aurez plus de code √† l'int√©rieur de ce fichier, mais ce que vous voyez ci-dessus est pertinent pour nous pour le moment.

1. Nous importons d'abord le Tracker d'OpenReplay et une variable cl√© (plus sur ces derniers dans un instant).
2. Nous instancions ensuite le Tracker. Comme vous pouvez le voir, l'unique option de configuration que nous utilisons est la cl√© du projet, que vous obtiendrez √† partir de l'interface utilisateur apr√®s avoir configur√© le projet dans OpenReplay.
3. Nous enregistrons l'instance du suivi dans le contexte cr√©√© en appelant `setContext`. La variable `key` sera plus tard utilis√©e pour r√©cup√©rer cette valeur particuli√®re du contexte.

üí°**Note pour les utilisateurs auto-h√©berg√©s:** si vous utilisez la version auto-h√©berg√©e d'OpenReplay, vous devrez √©galement sp√©cifier la propri√©t√© de configuration `ingestPoint` √† l'√©tape 2. Cette propri√©t√© sp√©cifie le point d'ingestion des donn√©es du suivi. Les utilisateurs du cloud n'ont pas besoin de cela, car, par d√©faut, le suivi saura o√π se trouve le point d'extr√©mit√© de la version SaaS, mais si vous l'auto-h√©bergez, vous devrez le sp√©cifier (ce devrait √™tre quelque chose comme `https://openreplay.mydomain.com/ingest`).

## Utilisation du contexte de suivi

Utiliser le contexte (et appeler la m√©thode `start`) est aussi simple que de r√©cup√©rer le contexte √† l'aide de la fonction `getContext` de Svelte.

Le contexte avait un objet avec une fonction appel√©e getTracker, donc nous le d√©structurons et appelons cette fonction.


```jsx
import {key} from "../../context/tracker"
  
let {getTracker} = getContext(key)
onMount( () => {
	let tracker = getTracker()
	tracker.start()
})
```


Ensuite, il suffit d'appeler la m√©thode `start` √† l'int√©rieur du rappel `onMount`. Nous le faisons pour nous assurer que nous appelons cette m√©thode depuis le navigateur, sinon le suivi ne fonctionnera pas.

## Le fichier contexte / suivi

Nous avons utilis√© ce fichier √† la fois, alors il est temps de jeter un coup d'≈ìil rapide.

Ce fichier exporte deux √©l√©ments principaux:

1. La classe `Tracker`, que nous avons instanci√©e dans le fichier de mise en page.
2. Nous utilisons la variable `key` pour enregistrer et r√©cup√©rer le contexte.

Voici le contenu du fichier:


```jsx
import Tracker from '@openreplay/tracker'

const key = Symbol("openreplay tracker")

export {Tracker, key}
```


La seule chose int√©ressante ici est que la variable `key` n'est pas une simple cha√Æne, c'est en fait un `Symbol`. La raison en est d'√©viter les collisions de noms potentielles avec d'autres biblioth√®ques tierces qui utilisent √©galement le contexte.

## Prise en charge des variables ENV

La derni√®re chose √† examiner ici est la fa√ßon dont nous g√©rons la cl√© du projet, car elle ne doit pas √™tre cod√©e en dur dans votre code.

Habituellement, vous utiliseriez une variable d'environnement pour cela, mais √©tant donn√© que nous avons besoin de ces donn√©es dans le navigateur et que Svelte ne fournit pas un moyen facile de le faire, nous r√©soudrons ce probl√®me avec deux packages: [dotevn] (https://www.npmjs.com/package/dotenv) et [@rollup/plugin-replace] (https://www.npmjs.com/package/@rollup/plugin-replace).

D'un c√¥t√©, nous utiliserons le package dotenv pour avoir la possibilit√© de d√©finir nos variables d'environnement dans un fichier `.env`. Nous d√©finirons celle dont nous avons besoin:


```jsx
OPENREPLAY_PROJECT_KEY="<YOUR PROJECT KEY>"
```


D'un autre c√¥t√©, √©tant donn√© que nous ne pouvons pas utiliser `dotenv` dans notre code c√¥t√© client (car il d√©pend du module `fs`, qui n'est clairement pas disponible dans le navigateur), nous utiliserons le plugin de remplacement pour le rouleau. Ce plugin remplacera le code dans nos fichiers par ce que nous lui dirons. Donc, nous configurons le plugin pour remplacer la cha√Æne `"__myapp.env.OPENREPLAY_PROJECT_KEY"` par la cl√© de projet r√©elle charg√©e √† partir du fichier `.env` (gr√¢ce au package dotenv).

Pour y parvenir, ouvrez le fichier `rollup.config.js` √† la racine du projet et ajoutez le code suivant dans la cl√© `plugins`.


```jsx
replace({
  "__myapp.env.OPENREPLAY_PROJECT_KEY": `"${process.env.OPENREPLAY_PROJECT_KEY}"`
})
```

